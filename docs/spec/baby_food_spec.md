# 離乳食記録機能 設計書

## 1. 概要

### 1.1 目的
離乳食の食材・量を記録し、赤ちゃんの食事履歴を管理できるようにする。食材ごとの摂取状況を把握し、アレルギー確認や栄養管理に役立てる。

### 1.2 機能概要
- 授乳表内に「離乳食」行を追加
- 時間軸のマス目タップで離乳食記録画面を表示
- 食材カテゴリから食材を選択
- 各食材の食べた量を記録（任意）
- 食材ごとに子供の反応を記録（good / normal / bad）
- ベビーの記録画面に「離乳食」タブを追加し、食材一覧をカテゴリ別に表示
- カスタム食材の追加

---

## 2. 画面仕様

### 2.1 授乳表への統合

授乳表の列に「離乳食」を追加する。

```
┌──────┬──────┬──────┬──────┬────────┬────┬────┬──────┬──────┐
│ 時間 │ 授乳 │ミルク│搾母乳│ 離乳食 │ 尿 │ 便 │ 体温 │その他│
│      │      │      │      │ ↑新規  │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│   7  │      │      │      │        │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│   8  │      │      │      │   ●    │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│   9  │      │      │      │        │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│  10  │      │      │      │        │    │    │ 37.2 │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│  11  │      │      │      │        │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│  12  │      │  50  │  50  │   ●    │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│  13  │      │      │      │        │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│  ... │      │      │      │        │    │    │      │      │
├──────┼──────┼──────┼──────┼────────┼────┼────┼──────┼──────┤
│ 合計 │ 2回  │140ml │ 50ml │  2回   │1回 │1回 │      │      │
└──────┴──────┴──────┴──────┴────────┴────┴────┴──────┴──────┘
```

#### 表示仕様
- 離乳食列には記録がある場合 ● を表示
- 合計行には離乳食の記録回数を表示

#### インタラクション
| アクション | 動作 |
|-----------|------|
| 空きマスをタップ | 離乳食記録画面（新規）を表示 |
| 記録済みマスをタップ | 離乳食記録画面（編集）を表示 |

---

### 2.2 食材選択画面

マス目タップ後に表示される画面。8つの食材カテゴリから食材を選択する。

```
┌─────────────────────────────────────────────────┐
│  ←  離乳食を記録           12:00               │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌───────────────┐  ┌───────────────┐          │
│  │  🍚           │  │  🐟           │          │
│  │ 米・パン・麺   │  │    魚        │          │
│  └───────────────┘  └───────────────┘          │
│                                                 │
│  ┌───────────────┐  ┌───────────────┐          │
│  │  🥩           │  │  🥬           │          │
│  │    肉        │  │   野菜        │          │
│  └───────────────┘  └───────────────┘          │
│                                                 │
│  ┌───────────────┐  ┌───────────────┐          │
│  │  🍎           │  │  🥛           │          │
│  │   果物        │  │  乳製品       │          │
│  └───────────────┘  └───────────────┘          │
│                                                 │
│  ┌───────────────┐  ┌───────────────┐          │
│  │  🫘           │  │  📦           │          │
│  │ 大豆製品      │  │  その他       │          │
│  └───────────────┘  └───────────────┘          │
│                                                 │
├─────────────────────────────────────────────────┤
│  選択中: にんじん, 豆腐, 米              [次へ] │
└─────────────────────────────────────────────────┘
```

#### カテゴリタップ後のプルダウン展開

カテゴリをタップすると、その場でプルダウン（またはボトムシート）が展開され、食材を選択できる。

```
┌─────────────────────────────────────────────────┐
│  ←  離乳食を記録           12:00               │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌───────────────┐  ┌───────────────┐          │
│  │  🍚 ▼         │  │  🐟           │          │
│  │ 米・パン・麺   │  │    魚        │          │
│  ├───────────────┤  └───────────────┘          │
│  │ ☑ 米         │                             │
│  │ ☐ パン粥     │                             │
│  │ ☑ うどん     │                             │
│  │ ☐ そば       │                             │
│  │ ☐ そうめん   │                             │
│  │ ☐ マカロニ   │                             │
│  │ ☐ スパゲッティ│                             │
│  │ ☐ 中華麺     │                             │
│  ├───────────────┤                             │
│  │ ＋ 追加する   │  ← カスタム食材追加         │
│  └───────────────┘                             │
│                                                 │
│  ...                                            │
│                                                 │
├─────────────────────────────────────────────────┤
│  選択中: 米, うどん                      [次へ] │
└─────────────────────────────────────────────────┘
```

#### カスタム食材追加ダイアログ

「＋ 追加する」タップ時に表示。

```
┌─────────────────────────────────────────────────┐
│  カスタム食材を追加                             │
├─────────────────────────────────────────────────┤
│                                                 │
│  食材名                                         │
│  ┌─────────────────────────────────────────┐   │
│  │                                         │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│         [キャンセル]        [追加]              │
└─────────────────────────────────────────────────┘
```

---

### 2.3 量の記録画面

食材選択後、「次へ」をタップすると遷移。選択した食材それぞれの量と、子供の反応を記録する。

```
┌─────────────────────────────────────────────────┐
│  ←  食べた量を記録                             │
├─────────────────────────────────────────────────┤
│                                                 │
│  🍚 米                                          │
│  ┌──────────────┐  ┌──────────────────────┐    │
│  │     5       │  │  大さじ  ▼           │    │
│  └──────────────┘  └──────────────────────┘    │
│                                                 │
│  🍜 うどん                                      │
│  ┌──────────────┐  ┌──────────────────────┐    │
│  │             │  │  g       ▼           │    │
│  └──────────────┘  └──────────────────────┘    │
│                    ↑ 量は未入力でもOK           │
│                                                 │
│  🥕 にんじん                                    │
│  ┌──────────────┐  ┌──────────────────────┐    │
│  │     2       │  │  小さじ  ▼           │    │
│  └──────────────┘  └──────────────────────┘    │
│                                                 │
│  🥬 豆腐                                        │
│  ┌──────────────┐  ┌──────────────────────┐    │
│  │    30       │  │  g       ▼           │    │
│  └──────────────┘  └──────────────────────┘    │
│  反応: [bear_good] [bear_normal] [bear_bad]     │
│                                                 │
├─────────────────────────────────────────────────┤
│                              [保存]             │
└─────────────────────────────────────────────────┘
```

#### 量の入力仕様

| 項目 | 仕様 |
|------|------|
| 量の入力 | 数値のフリー入力（小数可） |
| 単位選択 | `大さじ` / `小さじ` / `ml` / `g` の4択 |
| 入力必須 | いいえ（量未入力でも保存可能） |
| デフォルト単位 | `大さじ` |

#### 子供の反応の入力仕様

| 項目 | 仕様 |
|------|------|
| 反応の選択 | 子供のアイコンに応じた3択（good / normal / bad） |
| 表示アイコン | 例: 子供アイコンが `bear` の場合 `bear_good` / `bear_normal` / `bear_bad` |
| 入力必須 | いいえ（未選択でも保存可能） |

---

### 2.4 離乳食タブ（食材一覧画面）

ベビーの記録画面のタブ構成に「離乳食」タブを追加し、授乳表タブと成長曲線タブの間に配置する。
離乳食タブでは食材カテゴリごとのサブタブを表示し、各カテゴリで「食べたかどうか」「子供の反応」を確認できる。
データは `baby_food_records` を集計して表示する（案A）。

```
タブ構成: [授乳表] [離乳食] [成長曲線]
```

```
┌─────────────────────────────────────────────────┐
│  離乳食                                          │
├─────────────────────────────────────────────────┤
│  [米・パン・麺] [魚] [肉] [野菜] [果物] ...      │
├─────────────────────────────────────────────────┤
│  🍚 米            食べた      反応: bear_good    │
│  🍞 パン粥        未         反応: ー            │
│  🍜 うどん        食べた      反応: bear_normal  │
│  ...                                            │
└─────────────────────────────────────────────────┘
```

---

## 3. 食材カテゴリ・プリセット一覧

### 3.1 カテゴリ一覧

| カテゴリ | アイコン | プリセット食材 |
|---------|---------|---------------|
| 米・パン・麺 | 🍚 | 米, パン粥, うどん, そば, そうめん, マカロニ, スパゲッティ, 中華麺 |
| 魚 | 🐟 | タラ, タイ, しらす, カジキ, マグロ, ツナ, あじ, いわし, さば, さわら, さんま, ぶり, さけ, えび |
| 肉 | 🥩 | 鶏肉, 豚肉 |
| 野菜 | 🥬 | じゃがいも, さつまいも, さといも, やまいも, かぼちゃ, にんじん, 大根, かぶ, 玉ねぎ, 小松菜, ほうれん草, トマト, ブロッコリー, キャベツ, ピーマン, なす, きゅうり, いんげん, にら, ねぎ, 枝豆, とうもろこし, れんこん, オクラ, きのこ類 |
| 果物 | 🍎 | バナナ, りんご, みかん, ぶどう, いちご, 柿, 梨, すいか, メロン, もも |
| 乳製品 | 🥛 | ヨーグルト, 牛乳（調理用）, 牛乳（飲料用） |
| 大豆製品 | 🫘 | 豆腐, きな粉, 納豆, 豆乳, チーズ |
| その他 | 📦 | たまご, 海苔, わかめ, こんにゃく, ひじき, 春雨, ゼリー |

### 3.2 カスタム食材

- 各カテゴリにユーザーが独自の食材を追加可能
- カスタム食材は端末ローカル（またはFirestore）に保存
- 削除・編集も可能

---

## 4. データ構造

### 4.1 離乳食記録（BabyFoodRecord）

```
BabyFoodRecord
├── id: UUID
├── recordedAt: DateTime（記録日時）
├── childId: UUID（対象の子供）
├── items: List<BabyFoodItem>（食べた食材リスト）
├── createdAt: DateTime
└── updatedAt: DateTime
```

### 4.2 食材アイテム（BabyFoodItem）

```
BabyFoodItem
├── ingredientId: UUID（食材のID）
├── ingredientName: String（食材名）
├── categoryId: String（カテゴリID: grains, fish, meat, vegetables, fruits, dairy, soy, other）
├── amount: Double?（量、nullable）
├── unit: AmountUnit?（単位、nullable）
└── reaction: BabyFoodReaction?（子供の反応、nullable）
```

### 4.3 子供の反応（BabyFoodReaction）

```
enum BabyFoodReaction {
  good,
  normal,
  bad
}
```

### 4.4 量の単位（AmountUnit）

```
enum AmountUnit {
  tablespoon,  // 大さじ
  teaspoon,    // 小さじ
  ml,          // ml
  gram         // g
}
```

### 4.5 カスタム食材（CustomIngredient）

```
CustomIngredient
├── id: UUID
├── name: String（食材名）
├── categoryId: String（所属カテゴリID）
├── createdAt: DateTime
└── householdId: UUID（世帯ごとに管理）
```

---

## 5. Firestore構造

### 5.1 離乳食記録

```
households/{householdId}/children/{childId}/baby_food_records/{recordId}
├── recorded_at: Timestamp
├── items: [
│   {
│     ingredient_id: String,
│     ingredient_name: String,
│     category_id: String,
│     amount: Number? (nullable),
│     unit: String? (nullable: "tablespoon" | "teaspoon" | "ml" | "gram"),
│     reaction: String? (nullable: "good" | "normal" | "bad")
│   },
│   ...
│ ]
├── created_at: Timestamp
└── updated_at: Timestamp
```

### 5.2 カスタム食材

```
households/{householdId}/custom_ingredients/{ingredientId}
├── name: String
├── category_id: String
└── created_at: Timestamp
```

---

## 6. ユースケース

### 6.1 離乳食を新規記録する

1. 授乳表の「離乳食」行の空きマスをタップ
2. 食材選択画面が表示される
3. 食材カテゴリをタップしてプルダウンを展開
4. 食べた食材にチェックを入れる（複数選択可）
5. 必要に応じて他のカテゴリも展開して選択
6. 「次へ」ボタンをタップ
7. 量の記録画面に遷移
8. 各食材の量と単位を入力（任意）
9. 「保存」ボタンをタップ
10. 記録が保存され、授乳表に反映される

### 6.2 離乳食記録を編集する

1. 授乳表の記録済みマスをタップ
2. 既存の記録が読み込まれた状態で食材選択画面が表示
3. 食材の追加・削除を行う
4. 「次へ」ボタンをタップ
5. 量の編集を行う
6. 「保存」ボタンをタップ

### 6.3 カスタム食材を追加する

1. 食材選択画面でカテゴリをタップ
2. プルダウン最下部の「＋ 追加する」をタップ
3. ダイアログで食材名を入力
4. 「追加」をタップ
5. カスタム食材がリストに追加される

### 6.4 離乳食記録を削除する

1. 記録済みマスをタップ
2. 編集画面で「削除」ボタンをタップ
3. 確認ダイアログで「削除」を選択
4. 記録が削除される

---

## 7. バリデーション

| 項目 | ルール |
|------|--------|
| 食材選択 | 1つ以上の食材が選択されていること |
| 量 | 入力する場合は0以上の数値 |
| カスタム食材名 | 1文字以上、空白のみは不可 |
| 記録時刻 | 未来の日時は不可（当日まで） |

---

## 8. 表示仕様

### 8.1 授乳表での表示

- 「離乳食」列を「搾母乳」列の右側に追加（列順: 授乳, ミルク, 搾母乳, **離乳食**, 尿, 便, 体温, その他）
- 離乳食が記録されているマスには ● を表示
- 合計行には離乳食の記録回数を「◯回」形式で表示
- タップすると詳細を確認・編集可能

### 8.2 記録サマリー表示

離乳食マスをタップした際の詳細表示（編集画面）または、ロングタップでのプレビュー：

```
12:00 離乳食
──────────────
米 5大さじ
にんじん 2小さじ
豆腐 30g
うどん（量なし）
```

### 8.3 離乳食タブでの表示

- ベビーの記録画面のタブ順: **授乳表 / 離乳食 / 成長曲線**
- 離乳食タブは食材カテゴリごとのサブタブを表示
- 各食材行に「食べた/未」「反応（good/normal/bad）」を表示
- 反応アイコンは子供のアイコンに対応（例: bear_good / bear_normal / bear_bad）
- 表示データは `baby_food_records` の集計結果を使用（案A）

---

## 9. 今後の拡張案（スコープ外）

以下は本設計のスコープ外だが、将来的な拡張として検討可能：

- **アレルギー管理**: 初めて食べた食材のマーキング、アレルギー反応の記録
- **離乳食ステージ管理**: 初期・中期・後期・完了期の自動判定
- **レシピ機能**: 複数食材を組み合わせた料理の登録
- **食材履歴**: 食材ごとの摂取履歴グラフ
- **栄養バランス表示**: カテゴリごとの摂取バランスの可視化

---

## 10. 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-12-27 | 1.0 | 初版作成 |
