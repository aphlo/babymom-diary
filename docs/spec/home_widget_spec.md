# ãƒ›ãƒ¼ãƒ ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ»ãƒ­ãƒƒã‚¯ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ è¨­è¨ˆæ›¸

## 1. æ¦‚è¦

### 1.1 ç›®çš„
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒ—ãƒªã‚’é–‹ã‹ãšã«ã€ãƒ›ãƒ¼ãƒ ç”»é¢ã‚„ãƒ­ãƒƒã‚¯ç”»é¢ã‹ã‚‰ç´ æ—©ãè‚²å…è¨˜éŒ²ã‚’ç¢ºèªãƒ»ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

### 1.2 å¯¾è±¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
- **iOS**: Home Screen Widget + Lock Screen Widget (WidgetKit)
- **Android**: Home Screen Widget (App Widget)

### 1.3 ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆç¨®é¡

| ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ | ã‚µã‚¤ã‚º | ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  |
|-------------|--------|-----------------|
| æ¨ªé•·ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ | Medium (iOS) / 4x2 (Android) | iOS, Android |
| æ­£æ–¹å½¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ | Small (iOS) / 2x2 (Android) | iOS, Android |
| ãƒ­ãƒƒã‚¯ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ | Circular/Rectangular | iOS ã®ã¿ |

---

## 2. ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆä»•æ§˜

### 2.1 æ¨ªé•·ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆMedium / 4x2ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸ‘¶] ãŸã‚ã†  1æ­³2ãƒ¶æœˆ13æ—¥                   [åˆ‡æ›¿ãƒœã‚¿ãƒ³]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ¤± æˆä¹³(å³)    â”‚    ğŸ¼ ãƒŸãƒ«ã‚¯     â”‚     ğŸ’§ å°¿           â”‚
â”‚     12:00       â”‚      14:30       â”‚      13:45          â”‚
â”‚    2æ™‚é–“å‰      â”‚      30åˆ†å‰      â”‚     1æ™‚é–“å‰         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ¤±]  [ğŸ¼]  [ğŸ’§]  [ğŸ’©]  [ğŸŒ¡ï¸]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¨ç¤ºå†…å®¹
1. **ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨**
   - é¸æŠä¸­ã®å­ä¾›ã®åå‰
   - ç”Ÿå¾ŒçµŒéæ—¥æ•°ï¼ˆä¾‹: `1æ­³2ãƒ¶æœˆ13æ—¥`ã€`0ãƒ¶æœˆ15æ—¥ç›®`ï¼‰
   - å­ä¾›åˆ‡æ›¿ãƒœã‚¿ãƒ³ï¼ˆè¤‡æ•°ã®å­ä¾›ãŒã„ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰

2. **è¨˜éŒ²ã‚«ãƒ¼ãƒ‰éƒ¨ï¼ˆ3åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰**
   - **3ç¨®é¡**ã®`RecordType`ãã‚Œãã‚Œã®ç›´è¿‘1ä»¶ã‚’æ¨ªä¸¦ã³ã§è¡¨ç¤º
   - è¡¨ç¤ºé …ç›®: ã‚¢ã‚¤ã‚³ãƒ³ã€ç¨®åˆ¥åã€è¨˜éŒ²æ™‚åˆ»ã€çµŒéæ™‚é–“ï¼ˆä¾‹: `30åˆ†å‰`ï¼‰
   - è¡¨ç¤ºã™ã‚‹3ç¨®é¡ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã§é¸æŠå¯èƒ½
   - è©²å½“ç¨®åˆ¥ã®è¨˜éŒ²ãŒãªã„å ´åˆ: ã€Œ--ã€ã¨è¡¨ç¤º
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `breastRight`ï¼ˆã¾ãŸã¯`breastLeft`ï¼‰, `formula`, `pee`

3. **ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³éƒ¨**
   - 5ã¤ã®`RecordType`ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³
   - ã‚¿ãƒƒãƒ—ã§ã‚¢ãƒ—ãƒªèµ·å‹• â†’ è©²å½“ç¨®åˆ¥ã®è¨˜éŒ²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
   - è¡¨ç¤ºã™ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

#### ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å‹•ä½œ |
|-----------|------|
| ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå…¨ä½“ã‚¿ãƒƒãƒ— | ã‚¢ãƒ—ãƒªèµ·å‹•ï¼ˆãƒ™ãƒ“ãƒ¼ã®è¨˜éŒ²ç”»é¢ï¼‰ |
| å­ä¾›åˆ‡æ›¿ãƒœã‚¿ãƒ³ | æ¬¡ã®å­ä¾›ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã§å®Œçµï¼‰ |
| ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ | ã‚¢ãƒ—ãƒªèµ·å‹• + è¨˜éŒ²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºï¼ˆç¾åœ¨æ™‚åˆ»ãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰ |

---

### 2.2 æ­£æ–¹å½¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆSmall / 2x2ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãŸã‚ã†              â”‚
â”‚ 1æ­³2ãƒ¶æœˆ13æ—¥  [âŸ³]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¼ ãƒŸãƒ«ã‚¯           â”‚
â”‚ 14:30  30åˆ†å‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¨ç¤ºå†…å®¹
1. **ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨**
   - é¸æŠä¸­ã®å­ä¾›ã®åå‰
   - ç”Ÿå¾ŒçµŒéæ—¥æ•°
   - å­ä¾›åˆ‡æ›¿ãƒœã‚¿ãƒ³ï¼ˆè¤‡æ•°ã®å­ä¾›ãŒã„ã‚‹å ´åˆï¼‰

2. **è¨˜éŒ²è¡¨ç¤ºéƒ¨**
   - ç›´è¿‘1ä»¶ã®`Record`ã‚’è¡¨ç¤º
   - è¡¨ç¤ºé …ç›®: ã‚¢ã‚¤ã‚³ãƒ³ã€ç¨®åˆ¥åã€è¨˜éŒ²æ™‚åˆ»ã€çµŒéæ™‚é–“
   - è¨˜éŒ²ãŒãªã„å ´åˆ: ã€Œè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€

#### ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
- è¡¨ç¤ºã™ã‚‹`RecordType`ã‚’**1ç¨®é¡**æŒ‡å®šå¯èƒ½
- æŒ‡å®šãªã—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰: ç¨®åˆ¥ã«é–¢ä¿‚ãªãæœ€æ–°ã®è¨˜éŒ²ã‚’è¡¨ç¤º
- æŒ‡å®šã‚ã‚Š: è©²å½“ç¨®åˆ¥ã®æœ€æ–°è¨˜éŒ²ã®ã¿è¡¨ç¤º
- ä¾‹: ã€ŒãƒŸãƒ«ã‚¯ã€ã‚’æŒ‡å®š â†’ ãƒŸãƒ«ã‚¯ã®æœ€æ–°è¨˜éŒ²ã®ã¿è¡¨ç¤º

#### ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å‹•ä½œ |
|-----------|------|
| ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå…¨ä½“ã‚¿ãƒƒãƒ— | ã‚¢ãƒ—ãƒªèµ·å‹•ï¼ˆãƒ™ãƒ“ãƒ¼ã®è¨˜éŒ²ç”»é¢ï¼‰ |
| å­ä¾›åˆ‡æ›¿ãƒœã‚¿ãƒ³ | æ¬¡ã®å­ä¾›ã«åˆ‡ã‚Šæ›¿ãˆ |

---

### 2.3 ãƒ­ãƒƒã‚¯ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆiOSå°‚ç”¨ï¼‰

#### Circularï¼ˆå††å½¢ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”
â”‚ ğŸ¼  â”‚
â”‚30åˆ†å‰â”‚
â””â”€â”€â”€â”€â”€â”˜
```

#### Rectangularï¼ˆé•·æ–¹å½¢ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¼ ãƒŸãƒ«ã‚¯ 14:30 â”‚
â”‚    30åˆ†å‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¨ç¤ºå†…å®¹
- é¸æŠä¸­ã®å­ä¾›ã®æœ€æ–°`Record`
- è¡¨ç¤ºé …ç›®: ã‚¢ã‚¤ã‚³ãƒ³ã€ç¨®åˆ¥åï¼ˆRectangularã®ã¿ï¼‰ã€è¨˜éŒ²æ™‚åˆ»ã€çµŒéæ™‚é–“

#### ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
- ã‚¿ãƒƒãƒ—ã§ã‚¢ãƒ—ãƒªèµ·å‹•

---

## 3. ãƒ‡ãƒ¼ã‚¿é€£æºè¨­è¨ˆ

### 3.1 èª²é¡Œ
- ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ã‚¢ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹å¤–ã§å‹•ä½œã™ã‚‹ãŸã‚ã€Firestoreã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
- ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®æ›´æ–°é »åº¦ã«åˆ¶é™ãŒã‚ã‚‹ï¼ˆiOS: Timelineã€Android: updatePeriodMillisï¼‰
- ã‚¢ãƒ—ãƒªã¨ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã™ã‚‹ä»•çµ„ã¿ãŒå¿…è¦

### 3.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Flutter App                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Firestore  â”‚â”€â”€â”€â–¶â”‚  UseCase    â”‚â”€â”€â”€â–¶â”‚WidgetDataSync  â”‚  â”‚
â”‚  â”‚  (Remote)   â”‚    â”‚             â”‚    â”‚   Service      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         Shared Storage                   â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚ iOS: App Group (UserDefaults)       â”‚ â”‚
                    â”‚  â”‚ Android: SharedPreferences          â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Native Widget                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ iOS: WidgetKit  â”‚              â”‚ Android: AppWidgetâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å…±æœ‰ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### WidgetDataï¼ˆJSONå½¢å¼ã§ä¿å­˜ï¼‰

```json
{
  "lastUpdated": "2025-12-02T14:30:00.000Z",
  "selectedChildId": "child_abc123",
  "children": [
    {
      "id": "child_abc123",
      "name": "ãŸã‚ã†",
      "birthday": "2024-09-20"
    },
    {
      "id": "child_def456",
      "name": "ã¯ãªã“",
      "birthday": "2023-05-15"
    }
  ],
  "recentRecords": {
    "child_abc123": [
      {
        "id": "2025-12-02-14-formula-xxx",
        "type": "formula",
        "at": "2025-12-02T14:30:00.000Z",
        "amount": 120,
        "note": null
      },
      {
        "id": "2025-12-02-13-pee-yyy",
        "type": "pee",
        "at": "2025-12-02T13:45:00.000Z",
        "amount": null,
        "excretionVolume": "medium"
      }
    ],
    "child_def456": [
      // ...
    ]
  }
}
```

#### WidgetSettingsï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šï¼‰

```json
{
  "mediumWidget": {
    "displayRecordTypes": ["breastRight", "formula", "pee"],
    "quickActionTypes": ["breastRight", "formula", "pee", "poop", "temperature"]
  },
  "smallWidget": {
    "filterRecordType": null
  }
}
```

| è¨­å®šé …ç›® | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ | èª¬æ˜ |
|---------|-------------|------|
| `displayRecordTypes` | Medium | 3åˆ—ã§è¡¨ç¤ºã™ã‚‹3ç¨®é¡ã®RecordType |
| `quickActionTypes` | Medium | ä¸‹éƒ¨ã«è¡¨ç¤ºã™ã‚‹5ã¤ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| `filterRecordType` | Small | è¡¨ç¤ºã™ã‚‹RecordTypeï¼ˆnullã§å…¨ç¨®é¡ï¼‰|

### 3.4 ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ã‚¤ãƒ™ãƒ³ãƒˆ | åŒæœŸå†…å®¹ |
|---------|---------|
| ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ | å…¨ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸ |
| Recordè¿½åŠ /æ›´æ–°/å‰Šé™¤æ™‚ | è©²å½“childã®recentRecordsã‚’æ›´æ–° |
| å­ä¾›è¿½åŠ /æ›´æ–°/å‰Šé™¤æ™‚ | childrenãƒªã‚¹ãƒˆã‚’æ›´æ–° |
| é¸æŠä¸­ã®å­ä¾›å¤‰æ›´æ™‚ | selectedChildIdã‚’æ›´æ–° |
| ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šå¤‰æ›´æ™‚ | WidgetSettingsã‚’æ›´æ–° |

### 3.5 ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…

#### iOS: App Groupï¼ˆFlavorå¯¾å¿œï¼‰

ç’°å¢ƒã”ã¨ã«ç•°ãªã‚‹App Group IDã‚’ä½¿ç”¨ï¼š

| Flavor | App Group ID |
|--------|--------------|
| stg | `group.com.aphlo.babymomdiary.stg` |
| prod | `group.com.aphlo.babymomdiary` |

```swift
// STGç’°å¢ƒ
let userDefaults = UserDefaults(suiteName: "group.com.aphlo.babymomdiary.stg")

// PRODç’°å¢ƒ
let userDefaults = UserDefaults(suiteName: "group.com.aphlo.babymomdiary")

userDefaults?.set(jsonString, forKey: "widget_data")
```

#### Android: SharedPreferences
```kotlin
// Mode: MODE_PRIVATE with ContentProvider for widget access
val prefs = context.getSharedPreferences("widget_data", Context.MODE_PRIVATE)
prefs.edit().putString("widget_data", jsonString).apply()
```

#### Flutterå´ï¼ˆhome_widget ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½¿ç”¨ï¼‰
```dart
import 'package:home_widget/home_widget.dart';

// ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«App Group IDã‚’è¨­å®šï¼ˆmain_stg.dart / main_prod.dartï¼‰
await WidgetDataRepositoryImpl.initialize(isProduction: false); // STG
await WidgetDataRepositoryImpl.initialize(isProduction: true);  // PROD

// ãƒ‡ãƒ¼ã‚¿ä¿å­˜
await HomeWidget.saveWidgetData<String>('widget_data', jsonEncode(widgetData));

// ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆæ›´æ–°é€šçŸ¥
await HomeWidget.updateWidget(
  iOSName: 'MiluWidget',
  androidName: 'MiluWidgetProvider',
);
```

### 3.6 Flavorå¯¾å¿œã®è©³ç´°

#### Entitlements ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
ios/
â”œâ”€â”€ Runner/
â”‚   â”œâ”€â”€ Runner-stg.entitlements    # STGç”¨ (group.com.aphlo.babymomdiary.stg)
â”‚   â””â”€â”€ Runner-prod.entitlements   # PRODç”¨ (group.com.aphlo.babymomdiary)
â””â”€â”€ MiluWidget/
    â”œâ”€â”€ MiluWidget-stg.entitlements  # STGç”¨
    â””â”€â”€ MiluWidget-prod.entitlements # PRODç”¨
```

#### Xcode Build Configuration è¨­å®š

**Runner Target:**
| Configuration | CODE_SIGN_ENTITLEMENTS |
|---------------|------------------------|
| Debug-stg, Release-stg, Profile-stg | `Runner/Runner-stg.entitlements` |
| Debug-prod, Release-prod, Profile-prod | `Runner/Runner-prod.entitlements` |

**MiluWidget Target:**
| Configuration | CODE_SIGN_ENTITLEMENTS | PRODUCT_BUNDLE_IDENTIFIER |
|---------------|------------------------|---------------------------|
| Debug-stg, Release-stg, Profile-stg | `MiluWidget/MiluWidget-stg.entitlements` | `com.aphlo.babymomdiary.stg.MiluWidget` |
| Debug-prod, Release-prod, Profile-prod | `MiluWidget/MiluWidget-prod.entitlements` | `com.aphlo.babymomdiary.MiluWidget` |

---

## 4. ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯è¨­è¨ˆ

### 4.1 URLã‚¹ã‚­ãƒ¼ãƒ 

```
milu://record/add?type={RecordType}&time={ISO8601}
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å¿…é ˆ | èª¬æ˜ | ä¾‹ |
|-----------|------|------|-----|
| type | Yes | RecordTypeå | `formula`, `breastRight` |
| time | No | ãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç¾åœ¨æ™‚åˆ»ï¼‰ | `2025-12-02T14:30:00` |

#### ä¾‹
```
milu://record/add?type=formula&time=2025-12-02T14:30:00
milu://record/add?type=pee
```

### 4.2 ã‚¢ãƒ—ãƒªå†…ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```dart
// go_routerè¨­å®š
GoRoute(
  path: '/record/add',
  builder: (context, state) {
    final type = RecordType.values.byName(state.queryParams['type']!);
    final time = state.queryParams['time'] != null
        ? DateTime.parse(state.queryParams['time']!)
        : DateTime.now();
    return AddRecordPage(presetType: type, presetTime: time);
  },
)
```

---

## 5. ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šç”»é¢ï¼ˆã‚¢ãƒ—ãƒªå†…ï¼‰

### 5.1 è¨­å®šé …ç›®

#### æ¨ªé•·ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šï¼ˆMediumï¼‰

| è¨­å®šé …ç›® | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|---------|------|-----------|
| è¡¨ç¤ºã™ã‚‹è¨˜éŒ²ç¨®åˆ¥ | 3åˆ—ã§è¡¨ç¤ºã™ã‚‹3ç¨®é¡ã®RecordTypeã‚’é¸æŠ | æˆä¹³(å³), ãƒŸãƒ«ã‚¯, å°¿ |
| ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ä¸‹éƒ¨ã«è¡¨ç¤ºã™ã‚‹5ã¤ã®RecordTypeã‚’é¸æŠ | æˆä¹³(å³), ãƒŸãƒ«ã‚¯, å°¿, ä¾¿, ä½“æ¸© |

- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ä¸¦ã³æ›¿ãˆå¯èƒ½
- è¨˜éŒ²ç¨®åˆ¥ã¨ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ç‹¬ç«‹ã—ã¦è¨­å®šå¯èƒ½

#### æ­£æ–¹å½¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šï¼ˆSmallï¼‰

| è¨­å®šé …ç›® | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|---------|------|-----------|
| è¡¨ç¤ºã™ã‚‹è¨˜éŒ²ç¨®åˆ¥ | è¡¨ç¤ºã™ã‚‹1ç¨®é¡ã®RecordTypeã‚’é¸æŠï¼ˆã¾ãŸã¯ã€Œã™ã¹ã¦ã€ï¼‰ | ã™ã¹ã¦ |

- ã€Œã™ã¹ã¦ã€é¸æŠæ™‚ã¯ç¨®åˆ¥ã«é–¢ä¿‚ãªãæœ€æ–°ã®è¨˜éŒ²ã‚’è¡¨ç¤º

### 5.2 UIé…ç½®
- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ è¨­å®š â†’ ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®š

### 5.3 è¨­å®šç”»é¢ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®š                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â–  æ¨ªé•·ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                     â”‚
â”‚ è¡¨ç¤ºã™ã‚‹è¨˜éŒ²ç¨®åˆ¥ï¼ˆ3ã¤é¸æŠï¼‰          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ ğŸ¤±  â”‚ â”‚ ğŸ¼  â”‚ â”‚ ğŸ’§  â”‚            â”‚
â”‚ â”‚æˆä¹³ â”‚ â”‚ãƒŸãƒ«ã‚¯â”‚ â”‚ å°¿  â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                        [å¤‰æ›´]       â”‚
â”‚                                     â”‚
â”‚ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ5ã¤é¸æŠï¼‰        â”‚
â”‚ â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”         â”‚
â”‚ â”‚ğŸ¤± â”‚â”‚ğŸ¼ â”‚â”‚ğŸ’§ â”‚â”‚ğŸ’© â”‚â”‚ğŸŒ¡ï¸ â”‚         â”‚
â”‚ â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜         â”‚
â”‚                        [å¤‰æ›´]       â”‚
â”‚                                     â”‚
â”‚ â–  æ­£æ–¹å½¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                     â”‚
â”‚ è¡¨ç¤ºã™ã‚‹è¨˜éŒ²ç¨®åˆ¥                     â”‚
â”‚ â—‹ ã™ã¹ã¦                           â”‚
â”‚ â—‹ æˆä¹³                            â”‚
â”‚ â—‹ ãƒŸãƒ«ã‚¯                           â”‚
â”‚ â—‹ æ¾æ¯ä¹³                           â”‚
â”‚ â—‹ å°¿                               â”‚
â”‚ â—‹ ä¾¿                               â”‚
â”‚ â—‹ ä½“æ¸©                             â”‚
â”‚ â—‹ ãã®ä»–                           â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 6.1 Flutterå´

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ç”¨é€” |
|-----------|------|
| [home_widget](https://pub.dev/packages/home_widget) | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¨ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰ã€æ›´æ–°é€šçŸ¥ |
| [shared_preferences](https://pub.dev/packages/shared_preferences) | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šã®æ°¸ç¶šåŒ– |

### 6.2 iOSå´

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| WidgetKit | ãƒ›ãƒ¼ãƒ ç”»é¢/ãƒ­ãƒƒã‚¯ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ |
| SwiftUI | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆUI |
| App Groups | ã‚¢ãƒ—ãƒª-ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé–“ãƒ‡ãƒ¼ã‚¿å…±æœ‰ |

### 6.3 Androidå´

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| App Widget | ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ |
| Jetpack Glance | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆUIï¼ˆComposeé¢¨ï¼‰ |
| SharedPreferences | ã‚¢ãƒ—ãƒª-ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé–“ãƒ‡ãƒ¼ã‚¿å…±æœ‰ |

---

## 7. ã‚¢ãƒ—ãƒªå´å®Ÿè£…ï¼ˆFlutterï¼‰

### 7.1 æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

```
flutter/lib/src/features/widget/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ widget_data.dart           # ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå…±æœ‰ãƒ‡ãƒ¼ã‚¿
â”‚   â”‚   â””â”€â”€ widget_settings.dart       # ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®š
â”‚   â””â”€â”€ repositories/
â”‚       â””â”€â”€ widget_data_repository.dart # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ usecases/
â”‚   â”‚   â”œâ”€â”€ sync_widget_data.dart      # ãƒ‡ãƒ¼ã‚¿åŒæœŸUseCase
â”‚   â”‚   â””â”€â”€ update_widget_settings.dart # è¨­å®šæ›´æ–°UseCase
â”‚   â””â”€â”€ providers/
â”‚       â””â”€â”€ widget_providers.dart       # Riverpod Providers
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ widget_data_repository_impl.dart
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ widget_data_sync_service.dart # åŒæœŸã‚µãƒ¼ãƒ“ã‚¹
â””â”€â”€ presentation/
    â”œâ”€â”€ pages/
    â”‚   â””â”€â”€ widget_settings_page.dart   # è¨­å®šç”»é¢
    â””â”€â”€ viewmodels/
        â””â”€â”€ widget_settings_viewmodel.dart
```

### 7.2 ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚µãƒ¼ãƒ“ã‚¹

```dart
/// ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿åŒæœŸã‚µãƒ¼ãƒ“ã‚¹
class WidgetDataSyncService {
  final ChildRecordRepository _recordRepository;
  final ChildrenRepository _childrenRepository;

  /// Recordå¤‰æ›´æ™‚ã«å‘¼ã³å‡ºã—
  Future<void> onRecordChanged(String childId) async {
    final records = await _fetchRecentRecords(childId, limit: 10);
    await _updateWidgetData(childId, records);
    await HomeWidget.updateWidget(
      iOSName: 'MiluWidget',
      androidName: 'MiluWidgetProvider',
    );
  }

  /// å­ä¾›æƒ…å ±å¤‰æ›´æ™‚ã«å‘¼ã³å‡ºã—
  Future<void> onChildrenChanged(List<ChildSummary> children) async {
    await _updateChildrenInWidgetData(children);
    await HomeWidget.updateWidget(...);
  }

  /// é¸æŠå­ä¾›å¤‰æ›´æ™‚ã«å‘¼ã³å‡ºã—
  Future<void> onSelectedChildChanged(String childId) async {
    await _updateSelectedChildInWidgetData(childId);
    await HomeWidget.updateWidget(...);
  }
}
```

### 7.3 æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®çµ±åˆ

#### Recordè¿½åŠ æ™‚
```dart
// AddRecordUseCase
class AddRecord {
  final ChildRecordRepository _repository;
  final WidgetDataSyncService _widgetSync;

  Future<void> call({required String childId, required Record record}) async {
    await _repository.addRecord(childId, record);

    // ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸ
    await _widgetSync.onRecordChanged(childId);
  }
}
```

---

## 8. ãƒã‚¤ãƒ†ã‚£ãƒ–å´å®Ÿè£…æ¦‚è¦

### 8.1 iOS (WidgetKit + SwiftUI)

```swift
// MiluWidget.swift
struct MiluWidget: Widget {
    let kind: String = "MiluWidget"

    var body: some WidgetConfiguration {
        StaticConfiguration(kind: kind, provider: Provider()) { entry in
            MiluWidgetEntryView(entry: entry)
        }
        .configurationDisplayName("milu")
        .description("è‚²å…è¨˜éŒ²ã‚’ã™ã°ã‚„ãç¢ºèª")
        .supportedFamilies([.systemSmall, .systemMedium, .accessoryCircular, .accessoryRectangular])
    }
}

struct Provider: TimelineProvider {
    func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ()) {
        // App Groupã‹ã‚‰ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        let data = loadWidgetData()
        let entry = MiluEntry(date: Date(), data: data)

        // 15åˆ†å¾Œã«æ›´æ–°
        let nextUpdate = Calendar.current.date(byAdding: .minute, value: 15, to: Date())!
        let timeline = Timeline(entries: [entry], policy: .after(nextUpdate))
        completion(timeline)
    }
}
```

### 8.2 Android (Jetpack Glance)

```kotlin
// MiluWidgetProvider.kt
class MiluWidgetProvider : GlanceAppWidget() {
    override suspend fun provideGlance(context: Context, id: GlanceId) {
        val data = loadWidgetData(context)

        provideContent {
            MiluWidgetContent(data)
        }
    }
}

@Composable
fun MiluWidgetContent(data: WidgetData) {
    Column(
        modifier = GlanceModifier
            .fillMaxSize()
            .background(Color.White)
            .clickable(actionStartActivity<MainActivity>(
                actionParametersOf(
                    ActionParameters.Key<String>("deeplink") to "milu://record/add?type=formula"
                )
            ))
    ) {
        // UIå®Ÿè£…
    }
}
```

---

## 9. æ›´æ–°é »åº¦ã¨ãƒãƒƒãƒ†ãƒªãƒ¼è€ƒæ…®

### 9.1 iOS
- **Timelineæ›´æ–°**: 15åˆ†é–“éš”
- **ã‚¢ãƒ—ãƒªã‹ã‚‰ã®å¼·åˆ¶æ›´æ–°**: `WidgetCenter.shared.reloadAllTimelines()`
- **Background App Refresh**: æœ‰åŠ¹æ™‚ã«ã‚ˆã‚Šé »ç¹ã«æ›´æ–°å¯èƒ½

### 9.2 Android
- **updatePeriodMillis**: 30åˆ†ï¼ˆæœ€å°å€¤ï¼‰
- **ã‚¢ãƒ—ãƒªã‹ã‚‰ã®å¼·åˆ¶æ›´æ–°**: `AppWidgetManager.updateAppWidget()`
- **WorkManager**: ã‚ˆã‚Šç´°ã‹ã„åˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆ

### 9.3 æœ€é©åŒ–
- è¨˜éŒ²å¤‰æ›´æ™‚ã®ã¿å¼·åˆ¶æ›´æ–°ã‚’å®Ÿè¡Œ
- Timeline/updatePeriodMillisã¯ã€ŒçµŒéæ™‚é–“ã€ã®è¡¨ç¤ºæ›´æ–°ç”¨

---

## 10. å®Ÿè£…å„ªå…ˆåº¦

| å„ªå…ˆåº¦ | é …ç›® |
|--------|------|
| P0 | Flutterå´ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸåŸºç›¤ |
| P0 | iOSæ¨ªé•·ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ |
| P0 | Androidæ¨ªé•·ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ |
| P1 | iOSæ­£æ–¹å½¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ |
| P1 | Androidæ­£æ–¹å½¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ |
| P1 | iOSãƒ­ãƒƒã‚¯ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ |
| P2 | ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šç”»é¢ |
| P2 | ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º |
